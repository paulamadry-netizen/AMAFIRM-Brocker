<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>AmA Broker — Web Trader Demo</title>
<style>
/* même style que ta version parfaite */
*{box-sizing:border-box}body{font-family:Inter,Arial,sans-serif;margin:0;background:linear-gradient(135deg,#0b1220,#111b2d);color:#f3f4f6;min-height:100vh}.app{max-width:1400px;margin:0 auto;padding:16px}header{display:flex;justify-content:space-between;align-items:center;background:rgba(255,255,255,.05);padding:14px 20px;border-radius:14px;backdrop-filter:blur(10px);box-shadow:0 4px 12px rgba(0,0,0,.4)}.brand{font-size:26px;font-weight:700;letter-spacing:1px;color:#22d3ee}.brand span{color:#10b981}header .controls{display:flex;gap:14px;align-items:center;flex-wrap:wrap}select,input{padding:6px 10px;border-radius:6px;background:#1b2533;color:white;border:1px solid #334155}.price{font-weight:600;color:#e0e0e0}.layout{display:grid;grid-template-columns:1fr 380px;gap:16px;margin-top:16px}.chart,.sidebar .panel{background:rgba(255,255,255,.05);border-radius:14px;padding:14px;backdrop-filter:blur(10px);box-shadow:0 6px 18px rgba(0,0,0,.4)}.chart iframe{width:100%;height:480px;border:0;border-radius:10px}.fullscreen{position:fixed!important;top:0;left:0;width:100vw!important;height:100vh!important;z-index:999;background:#000;border-radius:0!important}.tradebox{display:flex;gap:10px;margin-top:14px}button.buy,button.sell{flex:1;font-weight:bold;border:none;padding:12px 20px;border-radius:10px;cursor:pointer;transition:all .2s;font-size:16px}button.buy{background:#10b981;color:white}button.sell{background:#ef4444;color:white}button.buy:hover{background:#059669}button.sell:hover{background:#dc2626}table{width:100%;border-collapse:collapse;font-size:14px}td,th{padding:6px 8px;text-align:left}th{color:#9ca3af}tr:nth-child(odd){background:rgba(255,255,255,.02)}footer{margin-top:20px;font-size:13px;text-align:center;color:#9ca3af}.full-btn{float:right;background:#1e293b;border:0;color:#22d3ee;padding:6px 12px;border-radius:6px;cursor:pointer;font-size:13px}.full-btn:hover{background:#0f172a}
.total-pnl{margin-top:10px;text-align:right;font-weight:bold;font-size:15px;color:#22d3ee;}
</style>
</head>
<body>
<div class="app">
  <header>
    <div class="brand">AmA <span>Broker</span></div>
    <div class="controls">
      <label>Actif :
        <select id="symbolSelect">
          <optgroup label="Indices">
            <option value="SPX">S&P 500</option>
            <option value="DJI">Dow Jones</option>
            <option value="NDX">NASDAQ 100</option>
            <option value="FTSE">FTSE 100</option>
            <option value="DAX">DAX 40</option>
            <option value="FCHI">CAC 40</option>
            <option value="NKY">Nikkei 225</option>
          </optgroup>
          <optgroup label="Forex">
            <option value="EURUSD">EUR/USD</option>
            <option value="GBPUSD">GBP/USD</option>
            <option value="USDJPY">USD/JPY</option>
            <option value="AUDUSD">AUD/USD</option>
            <option value="USDCAD">USD/CAD</option>
          </optgroup>
          <optgroup label="Métaux">
            <option value="GOLD">Or (Gold)</option>
          </optgroup>
        </select>
      </label>
      <div class="price">Prix actuel : <span id="priceDisplay">—</span></div>
      <label>Lots :
        <input type="number" id="lotInput" value="1" min="1" step="1" style="width:70px;text-align:center;">
      </label>
    </div>
  </header>

  <main class="layout">
    <section class="chart">
      <div style="display:flex;justify-content:space-between;align-items:center;">
        <h3 style="margin:0;color:#22d3ee;">Graphique</h3>
        <button class="full-btn" onclick="toggleFullscreen()">⛶ Plein écran</button>
      </div>
      <iframe id="tradingviewIframe"
        src="https://s.tradingview.com/widgetembed/?symbol=INDEX:SPX&interval=1&theme=dark&hide_side_toolbar=1"></iframe>

      <div class="tradebox">
        <button class="buy" onclick="placeOrder('buy')">ACHETER</button>
        <button class="sell" onclick="placeOrder('sell')">VENDRE</button>
      </div>
    </section>

    <aside class="sidebar">
      <div class="panel">
        <h3 style="color:#22d3ee;">Positions Ouvertes</h3>
        <table id="positionsTable">
          <thead><tr><th>Sym</th><th>Side</th><th>Lots</th><th>Entrée</th><th>Dernier</th><th>PnL</th><th></th></tr></thead>
          <tbody></tbody>
        </table>
        <div id="totalPnl" class="total-pnl">PnL total : 0.0000</div>
      </div>
    </aside>
  </main>

  <footer>© 2025 AmA Broker • Données Stooq • Graphiques TradingView</footer>
</div>

<script>
const SYMBOL_MAP = {
  SPX:{stooq:"^SPX",tv:"INDEX:SPX"},DJI:{stooq:"^DJI",tv:"INDEX:DJI"},NDX:{stooq:"^NDX",tv:"INDEX:NDX"},
  FTSE:{stooq:"^FTSE",tv:"INDEX:UKX"},DAX:{stooq:"^DAX",tv:"INDEX:DAX"},FCHI:{stooq:"^CAC",tv:"INDEX:FR40"},
  NKY:{stooq:"^NKX",tv:"INDEX:NKY"},EURUSD:{stooq:"EURUSD",tv:"FX:EURUSD"},GBPUSD:{stooq:"GBPUSD",tv:"FX:GBPUSD"},
  USDJPY:{stooq:"USDJPY",tv:"FX:USDJPY"},AUDUSD:{stooq:"AUDUSD",tv:"FX:AUDUSD"},USDCAD:{stooq:"USDCAD",tv:"FX:USDCAD"},
  GOLD:{stooq:"GC.F",tv:"TVC:GOLD"}
};
let positions=[];let currentSymbol="SPX";let currentPrice=null;

async function fetchStooqPrice(symbol){
  try{
    const url=`https://stooq.com/q/l/?s=${symbol}&f=sd2t2ohlcv&h&e=csv`;
    const res=await fetch(url);
    const text=await res.text();
    const line=text.split("\n")[1];
    const parts=line.split(",");
    const last=parseFloat(parts[6]);
    return isNaN(last)?null:last;
  }catch{return null;}
}

async function updatePrice(){
  const stooqSymbol=SYMBOL_MAP[currentSymbol].stooq;
  const price=await fetchStooqPrice(stooqSymbol);
  if(price){
    currentPrice=price;
    document.getElementById("priceDisplay").innerText=price.toFixed(4);
    updatePnL();
  }
}
setInterval(updatePrice,1000);
updatePrice();

async function placeOrder(side){
  const price=await fetchStooqPrice(SYMBOL_MAP[currentSymbol].stooq);
  const qty=parseInt(document.getElementById("lotInput").value)||1;
  if(!price)return;
  const pos={id:Date.now(),symbol:currentSymbol,side,qty,entry:price,pnl:0};
  positions.push(pos);
  renderPositions();
}

function closePosition(id){
  positions=positions.filter(p=>p.id!==id);
  renderPositions();
}

function updatePnL(){
  let total=0;
  positions.forEach(p=>{
    if(currentPrice&&p.symbol===currentSymbol){
      const dir=p.side==="buy"?1:-1;
      p.pnl=(currentPrice-p.entry)*dir*p.qty;
    }
    total+=p.pnl;
  });
  renderPositions(total);
}

function renderPositions(total=0){
  const tbody=document.querySelector("#positionsTable tbody");
  tbody.innerHTML="";
  positions.forEach(p=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${p.symbol}</td>
      <td>${p.side}</td>
      <td>${p.qty}</td>
      <td>${p.entry.toFixed(4)}</td>
      <td>${currentPrice?currentPrice.toFixed(4):"—"}</td>
      <td style="color:${p.pnl>0?'#10b981':p.pnl<0?'#ef4444':'white'}">${p.pnl.toFixed(4)}</td>
      <td><button onclick="closePosition(${p.id})" style="background:#334155;color:white;border:0;padding:4px 8px;border-radius:6px;cursor:pointer;">✖</button></td>
    `;
    tbody.appendChild(tr);
  });
  const totalPnl=document.getElementById("totalPnl");
  totalPnl.innerText="PnL total : "+total.toFixed(4);
  totalPnl.style.color=total>0?"#10b981":total<0?"#ef4444":"#22d3ee";
}

document.getElementById("symbolSelect").addEventListener("change",e=>{
  currentSymbol=e.target.value;
  const tv=SYMBOL_MAP[currentSymbol].tv;
  document.getElementById("tradingviewIframe").src=
    `https://s.tradingview.com/widgetembed/?symbol=${encodeURIComponent(tv)}&interval=1&theme=dark&hide_side_toolbar=1`;
  updatePrice();
});

function toggleFullscreen(){
  document.getElementById("tradingviewIframe").classList.toggle("fullscreen");
}
</script>
</body>
</html>


